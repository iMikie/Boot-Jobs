/**
 * Cookie plugin
 *
 * Copyright (c) 2006 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */
function replaceAll(e,t,n,i){if(!e)return e;var r=i?e.toLowerCase():e,o=i?t.toLowerCase():t;if(-1==r.indexOf(o))return e;if(r==o)return n;for(var a="",s=0;s<r.length;s++)s<=r.length-o.length&&r.substr(s,o.length)==o?(a=a.concat(n),s+=o.length-1):a=a.concat(e.charAt(s));return a}function textCounter(){var e=$("#"+$(this).attr("id")+"_counter");if(0!=e.length){var t=parseInt(e.attr("class").match(/max_(\d+)/)[1]);$(this).on("visible keyup keydown change paste focus textCounter",function(){e.find("span.character_count").html($(this).val().length),e.toggleClass("error",$(this).val().length>t)}),$(this).trigger("textCounter")}}function initPage(){"undefined"!=typeof jQuery.facybox&&jQuery("a[rel*=facybox]").each(function(){$(this).data("facybox-initialized")||($(this).facybox({modal:!0}),$(this).data("facybox-initialized",!0))}),$(document).on("click",".hidden_more",function(){$(this).siblings(".hidden").show(),$(this).siblings(".elipses").hide(),$(this).remove()})}function toggle_id(e){$("#"+e).toggle(),$("#more_"+e).html("")}function selector_refresh(){$(".selector_single_item").each(function(){if($(this).attr("class").indexOf("disabled")<0){var e=$(this).attr("item_id");Selector[e]?($(this).prop("checked",!0),$(this).text("Unselect"),$(this).addClass("alternate")):($(this).prop("checked",!1),$(this).text("Select"),$(this).removeClass("alternate"))}})}function decrease_count(e){count=$("#"+e).text(),"undefined"!=typeof count&&0==count.indexOf("(")&&(count=count.substr(1,count.length-2),count--,$("#"+e).text(count>0?"("+count+")":""))}function load_request(e){load_request_thread_id++;var t=load_request_thread_id;e.secondary_id&&""!=e.secondary_id&&($("#"+e.secondary_id).attr("disabled",!0),$("#"+e.secondary_id).find("input").attr("disabled",!0)),$("#"+e.object_id).fadeTo(100,.5);var n="post",i=parse_include_ids_from_url(e.url),r=i.include_ids;e.url=i.url;var o=decodeURIComponent(e.url).split("?"),a=$.parseQuery(o[o.length-1]);a.skip_loading=!0,a.include_ids=r,$("div#url_for").attr("url",decodeURIComponent($.param(a))),$.ajax({url:e.loading_method,data:a,type:n,dataType:"json",success:function(n){n.html&&load_request_thread_id==t&&($("#"+e.object_id).html(n.html),load_request_callback(e))}})}function load_request_callback(options){options.secondary_id&&""!=options.secondary_id&&($("#"+options.secondary_id).attr("disabled",!1),$("#"+options.secondary_id).find("input").attr("disabled",!1)),options.alt_method?eval(options.alt_method):"undefined"!=typeof load_request_global_callback&&eval(load_request_global_callback),options.callback&&options.callback();var parsed_url=decodeURIComponent(options.url.replace(window.location.pathname+"?",""));options.loading_method&&(parsed_url=parsed_url.replace(options.loading_method+"?",""));var q=$.parseQuery(parsed_url);options.url.match(/AL_/)&&(q.render_tags=1),delete q.per_page;var link_url=window.location.pathname+($.isEmptyObject(q)?"":"?"+$.param(q));$("#page_link").attr("href",link_url),$("#"+options.object_id).fadeTo(100,1),TipTip.init(),selector_refresh()}function parse_include_ids_from_url(e){var t="",n=$.parseQuery(e.replace(window.location.pathname+"?",""));return n.include_ids&&(t=n.include_ids,delete n.include_ids),{include_ids:t,url:window.location.pathname+"?"+$.param(n)}}function Messages(){return self}function open_notification_popup(e,t,n,i,r){"undefined"!=typeof event?event.stopPropagation():jQuery.Event("click").stopPropagation();var o=document.getElementById(e+"_main"),a=document.getElementById(e+"_close"),s=document.getElementById(e+"_content"),l=document.getElementById(e+"_title");if($.facybox.settings.opacity=0,$.facybox.loading(),"undefined"==typeof r)$.ajax({url:"/"+t,data:n,type:"post",dataType:"json",success:function(e){var t=$(o);$.facybox.reveal(t,t.parent()),facybox_borders(!1),$(s).html(e.html),$(l).html(e.title),$(l).show(),require(["qtip"],function(){$(".tiptip").qtip({show:{delay:0},defaultPosition:"top"})})}});else{var c=$(o);$.facybox.reveal(c,c.parent()),facybox_borders(!1),$(s).html(r),$(l).html(i).show()}$(a).bind("click",{thisObject:this},function(e){$(o).hide(),e.stopPropagation(),$.facybox.settings.opacity=.3,facybox_borders(!0),$.facybox.close()}),$("body").unbind(),$(o).attr("close")||setTimeout(function(){$("body").click(function(){$(a).click()})},500),$(document).bind("afterClose.facybox",function(){facybox_borders(!0),$(o).hide()})}function facybox_borders(e){var t=[".nw",".n",".ne",".w",".e",".sw",".s",".se"];for(v in t)$("#facybox").find(t[v]).attr("style","display: "+(e?"":"none")+";");$("#facybox .body").attr("style","background: "+(e?"white":"transparent")+";")}jQuery.cookie=function(e,t,n){if("undefined"==typeof t){var i=null;if(document.cookie&&""!=document.cookie)for(var r=document.cookie.split(";"),o=0;o<r.length;o++){var a=jQuery.trim(r[o]);if(a.substring(0,e.length+1)==e+"="){i=decodeURIComponent(a.substring(e.length+1));break}}return i}n=n||{},null===t&&(t="",n.expires=-1);var s="";if(n.expires&&("number"==typeof n.expires||n.expires.toUTCString)){var l;"number"==typeof n.expires?(l=new Date,l.setTime(l.getTime()+24*n.expires*60*60*1e3)):l=n.expires,s="; expires="+l.toUTCString()}var c=n.path?"; path="+n.path:"",u=n.domain?"; domain="+n.domain:"",d=n.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),s,c,u,d].join("")},String.prototype.toTitleCase=function(){return this.replace(/([\w&`'\u2018\u2019"\u201c.@:\/\{\(\[<>_]+-? *)/g,function(e,t,n,i){return n>0&&":"!==i.charAt(n-2)&&e.search(/^(a(nd?|s|t)?|b(ut|y)|en|are|is|for|i[fn]|o[fnr]|t(he|o)|vs?\.?|via)[ \-]/i)>-1?e.toLowerCase():i.substring(n-1,n+1).search(/['"_{(\[]/)>-1?e.charAt(0)+e.charAt(1).toUpperCase()+e.substr(2):e.substr(1).search(/[A-Z]+|&|[\w]+[._][\w]+/)>-1||i.substring(n-1,n+1).search(/[\])}]/)>-1?e:e.charAt(0).toUpperCase()+e.substr(1)})},String.prototype.replaceAutocomplete=function(e,t){e=replaceAll(e.trim().trimDoubleSpaces(),"-"," ");var n=" "+replaceAll(replaceAll(this,"."," "),"-"," "),i=n.toLowerCase().indexOf(" "+e.toLowerCase());if(-1==i)return this;var r="";return r+=this.substr(0,i),r+=t.indexOf("%s")?replaceAll(t,"%s",this.substr(i,e.length)):t,r+=this.substr(i+e.length)},String.prototype.trimDoubleSpaces=function(){return this.replace(/\s{2,}/g," ")},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},String.prototype.replaceAll=function(e,t,n){return replaceAll(this,e,t,n)};var MentionsAutocomplete=function(e,t,n,i,r,o,a){if(this.user_id=e,this.raw_edit_id=t,this.edit_id="[data-id='"+t+"']",this.form_id="[data-id='"+t+"_form']",this.mentions_edit_id="[data-id='mentions_"+t+"']",this.holder_id="#"+n,this.id=e+"_"+t,this.selectedItem=0,this.results=[],this.delayCounter=0,this.results_buffer=[],this.last_mention="",this.active_mentions=[],this.html_area_holder=this.mentions_edit_id+" .html_area_holder",this.text_area_holder=this.mentions_edit_id+" .text_area_holder",$(this.edit_id).length>0){var s=$(this.edit_id).css("font-size");s&&(this.font_size=parseInt(s));var l=$(this.edit_id).css("line-height");l&&(this.line_height=parseInt(l)),this.tag_name=$(this.edit_id).get()[0].tagName.toLowerCase()}else this.tag_name="textarea";this.font_size=r?r:this.font_size||13,this.line_height=o?o:this.line_height||16,this.msign=a&&a.sign?a.sign:"@","blank"==this.msign&&(this.msign=""),"undefined"==typeof MentionsAutocomplete.all&&(MentionsAutocomplete.all={}),MentionsAutocomplete.all[this.id]=this,this.init=function(){if(0==$(this.mentions_edit_id).length){$(this.edit_id).parent().prepend($("<div class='mentions_input_holder' data-id='mentions_"+this.raw_edit_id+"'></div>")),$(this.mentions_edit_id).append($("<div class='html_area_holder'></div>")),$(this.mentions_edit_id).append($("<div class='text_area_holder'></div>"));var e=$(this.edit_id).val(),t=$(this.edit_id).clone();$(this.edit_id).attr("data-id",this.raw_edit_id+"_form"),$(this.text_area_holder).append($(t)),$(this.form_id).hide(),$(this.form_id).val(e),$(this.edit_id).val(e);var n=["width","height","padding-left","padding-top","padding-bottom","padding-right","font-weight"];for(var i in n)$(this.html_area_holder).css(n[i],$(this.edit_id).css(n[i]));$(this.text_area_holder+" "+this.tag_name).css("font-size",this.font_size+"px"),$(this.text_area_holder+" "+this.tag_name).css("line-height",this.line_height+"px"),$(this.html_area_holder).css("font-size",this.font_size+"px"),$(this.html_area_holder).css("line-height",this.line_height+"px")}this.allowed_chars=[];var r=["<",">","(",")","?","!",".",",",":",";","'",'"'," ","\n","\r","	"];for(var i in r)this.allowed_chars[r[i]]=!0;this.init_mentions()},this.init_mentions=function(){var e=$(this.edit_id).val(),t=this;e&&(e.indexOf(this.msign)>=0||""==this.msign)&&$.getJSON("/mentions/init_mentions",{text:e},function(n){if(n.active_mentions){t.active_mentions=n.active_mentions;var i=" "+e+" ";for(var r in t.active_mentions)i=t.replace_mentions(i,t.active_mentions[r].slug,r);i=i.slice(1,i.length-1),$(t.form_id).val(i),$(t.edit_id).val(i),t.init_html_area()}})},this.init(),$(this.edit_id).bind("keypress",{thisObject:this},function(e){e.data.thisObject.update_html_size(1),e.data.thisObject.update_html_area()}),$(this.edit_id).bind("keyup",{thisObject:this},function(e){return e.data.thisObject.update_html_size(1),27==e.keyCode?(e.data.thisObject.hideAutocomplete(),!1):40==e.keyCode?(e.data.thisObject.incSelection(),!1):38==e.keyCode?(e.data.thisObject.decSelection(),!1):(e.data.thisObject.showHideAutocomplete_with_delay(),!0)}),$(this.edit_id).bind("keydown",{thisObject:this},function(e){if(e.data.thisObject.update_html_size(1),13==e.keyCode){var t=e.data.thisObject.lastWord();return t[0]!=e.data.thisObject.msign&&""!=e.data.thisObject.msign||!e.data.thisObject.useItem()?(e.data.thisObject.update_html_area(),!0):!1}return 40!=e.keyCode&&38!=e.keyCode||!e.data.thisObject.isAutocompleteOpen()?(e.data.thisObject.update_html_area(),!0):!1}),$(this.edit_id).bind("focus",{thisObject:this},function(e){e.data.thisObject.init_html_area(),e.data.thisObject.showHideAutocomplete_with_delay(),$(e.data.thisObject.form_id).closest("form").find("input[type='submit']").removeAttr("disabled")}),$(this.edit_id).bind("focusout",{thisObject:this},function(e){e.data.thisObject.init_html_area(),setTimeout(function(){e.data.thisObject.hideAutocomplete()},100)}),$(this.form_id).closest("form").submit({thisObject:this},function(e){var t=e.data.thisObject;""!=$(t.edit_id).val()&&setTimeout(function(){$(t.edit_id).html(""),$(t.html_area_holder).html(""),$(t.html_area_holder).hide(),$(t.text_area_holder+" "+this.tag_name).css("background-color","white"),t.update_html_size(1),t.last_mention=""},100)}),this.sanitizeQuery=function(e){return e.replace(/[^A-Za-z0-9 @\-]/g,"")},this.lastWord=function(){var e=$(this.edit_id).val(),t=$(this.edit_id)[0].selectionStart;"undefined"==typeof t&&(t=e.length),e=e.slice(0,t);var n="",i=0;if(""==this.msign){i=0;for(var r in this.active_mentions){var o=e.lastIndexOf(this.active_mentions[r].mention);o>=0&&(o+=this.active_mentions[r].mention.length),o>i&&(i=o)}}else i=e.lastIndexOf(this.msign);if(i>=0){var n=e.substr(i+this.msign.length);if(n.length<=45&&n.length>0){if("\n"==e[e.length-1])return"";var a=n;n=this.sanitizeQuery(n),n=n!=a||i>=this.msign.length&&""!=e.charAt(i-1).replace(/[^A-Za-z0-9]/,"")?"":this.msign+n}else n=""}return n},this.isAutocompleteOpen=function(){return $(this.holder_id).is(":visible")},this.showHideAutocomplete_with_delay=function(){var e=++this.delayCounter,t=this;setTimeout(function(){t.showHideAutocomplete(e)},50)},this.showHideAutocomplete=function(e){if(this.delayCounter==e){var t=this.lastWord();if(""==this.msign||t[0]==this.msign&&this.last_mention!=t){(t.length>=2||t.length>=1&&""==this.msign)&&this.showAutocomplete(t)}else this.hideAutocomplete()}},this.showAutocomplete=function(e){if(e=e.slice(this.msign.length).toLowerCase(),this.results_buffer[e])this.results=this.results_buffer[e],this.renderResults();else{var t=((new Date).getTime(),this);$.getJSON("/mentions/search",{mention:e},function(n){t.results=n,t.results_buffer[e]=n,e.toLowerCase()==t.lastWord().slice(t.msign.length).toLowerCase()&&t.renderResults()})}},this.hideAutocomplete=function(){this.results=[],$(this.holder_id).hide()},this.selectItem=function(e){$("#"+this.id+"_item_"+this.selectedItem).attr("class","item"),$("#"+this.id+"_item_"+e).attr("class","item selected"),this.selectedItem=e},this.incSelection=function(){this.selectedItem<this.results.length-1&&this.selectItem(this.selectedItem+1)},this.decSelection=function(){this.selectedItem>0&&this.selectItem(this.selectedItem-1)},this.useItem=function(){var e=this.results[this.selectedItem];return"undefined"!=typeof e?(this.useSlug(e.id,e.type,e.name,e.slug),!0):!1},this.useSlug=function(e,t,n,i){var r=this.lastWord(),o=$(this.edit_id).val(),a=$(this.edit_id)[0].selectionStart;"undefined"==typeof a&&(a=o.length);var s=o.slice(0,a),l=o.slice(a,o.length),c=n;if(c+=" ",r[0]==this.msign||""==this.msign){s=s.slice(0,s.length-r.length),$(this.edit_id).val(s+this.msign+c+l),$(this.edit_id).set_cursor(s.length+c.length+1),this.last_mention=this.msign+c,this.hideAutocomplete();var u=[];u.id=e,u.type=t,u.slug=this.msign+i,u.mention=c,this.active_mentions[this.msign+n.trim()]=u,this.update_html_area()}},this.renderResults=function(){if(0==this.results.length)return void this.hideAutocomplete();var e="<div id='"+this.holder_id+"' class='mentions_holder'>";this.selectedItem=0;for(var t in this.results){var n=this.results[t];this.active_mentions[this.msign+n.name]&&this.active_mentions[this.msign+n.name].slug!=this.msign+n.slug||(e+="<div class='item "+(0==t?"selected":"")+"' id='"+this.id+"_item_"+t+"' onclick='MentionsAutocomplete.all[\""+this.id+'"].useSlug("'+n.id+'", "'+n.type+'", "'+n.name+'", "'+n.slug+"\")' onmouseover='MentionsAutocomplete.all[\""+this.id+'"].selectItem('+t+");'>",e+="<div class='pic'><img src='"+n.pic+"'></div>",e+="<div class='info'>",e+="<div class='name'>"+n.highlighed_name+"</div>",n.desc&&(e+="<div class='desc'>"+n.desc+"</div>"),e+="</div>",e+="</div>",e+="<div class='cb'></div>")}e+="</div>",$(this.holder_id).html(e),$(this.holder_id).show()},this.update_html_area=function(){$(this.html_area_holder).show(),$(this.text_area_holder+" "+this.tag_name).css("background-color","transparent");var e=this;setTimeout(function(){if(!$(e.form_id).closest("form").find("input[type='submit']").attr("disabled")){var t=$(e.edit_id).val(),n=$("<div/>").text(t).html(),i=t,r=[];for(var o in e.active_mentions)if(t.indexOf(o)>=0){var a="<a data-type='"+e.active_mentions[o].type+"' data-id='"+e.active_mentions[o].id+"'>"+o+"</a>";r[o]=a,n=e.replace_mentions(n,o,a),i=e.replace_mentions(i,o,a)}var s=i;for(o in r)s=s.replaceAll(r[o],e.active_mentions[o].slug);null!=n&&(n=n.replace(/\n/g,"<br>")),null!=s&&(s=s.replaceAll("<br>","\n").slice(s)),$(e.html_area_holder).html(n),$(e.form_id).val(s),$(e.html_area_holder).find("a").css("top",-$(e.edit_id).scrollTop()+"px")}},5)},this.replace_mentions=function(e,t,n){for(var i="",r=(" "+e+" ").split(t),o=r.length,a=0;o>a;a++)i+=r[a],o-1>a&&(i+=this.allowed_chars[r[a][r[a].length-1]]&&this.allowed_chars[r[a+1][0]]?n:t);return i.slice(1,i.length-1)},this.update_html_size=function(e){var t=this;setTimeout(function(){$(t.html_area_holder).css("width",$(t.edit_id).css("width")),$(t.html_area_holder).css("height",$(t.edit_id).css("height")),$(t.mentions_edit_id).css("float","left"),$(t.html_area_holder).find("a").css("top",-$(t.edit_id).scrollTop()+"px")},e)},this.init_html_area=function(){this.update_html_size(1),this.update_html_area()},this.hideAutocomplete(),this.update_html_size(50),this.update_html_area()};$.fn.set_cursor=function(e){return this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,e);else if(this.createTextRange){var t=this.createTextRange();t.collapse(!0),t.moveEnd("character",e),t.moveStart("character",e),t.select()}})};var angellist={},dealFeed={wideLoading:function(){return $('<div class="loader-repl"></div>')},startTagFollowing:function(){var e=$(this),t=dealFeed.wideLoading(),n=e.replaceWith(t);return $.ajax({url:e.attr("href"),data:"",success:function(e){t.replaceWith("success"==e.status?e.html:n)},type:"post"}),!1},stopTagFollowing:function(){var e=$(this),t=dealFeed.wideLoading(),n=e.replaceWith(t);return $.ajax({url:e.attr("href"),data:"",success:function(e){t.replaceWith("success"==e.status?e.html:n)},type:"post"}),!1}};jQuery(function(e){e(document).on("click",".follow-tag-btn",dealFeed.startTagFollowing),e(document).on("click",".unfollow-tag-btn",dealFeed.stopTagFollowing),e('input[type="text"], textarea').each(textCounter)}),jQuery(function(e){initPage(),e(document).ajaxComplete(initPage)});var Selector=[],load_request_thread_id=0,Pagination=function(e){this.url=e.url,this.page=e.page,this.per_page=e.per_page,this.object_id=e.object_id,this.options=e.options,this.loading_method=e.loading_method,this.identifier=e.identifier,this.loading=!1,$("#more_pagination_button_"+this.object_id).data("is_pagination_bound")||(this.bind_all=function(){$("#more_pagination_button_"+this.object_id).bind("click",{thisObject:this},function(e){e.data.thisObject.event_click("more")}),$("#more_pagination_button_"+this.object_id).data("is_pagination_bound",!0),$("#previous_pagination_button_"+this.object_id).bind("click",{thisObject:this},function(e){e.data.thisObject.event_click("previous")}),$("#next_pagination_button_"+this.object_id).bind("click",{thisObject:this},function(e){e.data.thisObject.event_click("next")})},this.bind_all(),this.event_click=function(e){this.loading||this.load_results(e),this.loading=!0},this.load_results=function(e){$("#"+e+"_pagination_button_"+this.object_id).attr("class",e+"_pagination_button"),$("#"+e+"_pagination_button_"+this.object_id).html(dealFeed.wideLoading()),"more"!=e&&$("#"+this.object_id).fadeTo(100,.5);var t="get";this.url.length>100&&(t="post"),this.url=this.url.replace(/amp;/g,"");var n=parse_include_ids_from_url(this.url),i=n.include_ids;this.url=n.url;var r=this,o="previous"==e?-1:1,a=r.options&&r.options.full_load;if(this.loading_method){var s=decodeURIComponent(this.url).split("?"),l=$.parseQuery(s[s.length-1]);delete l.page,$.ajax({url:r.loading_method,data:$.extend({page:r.page+o,per_page:r.per_page,skip_loading:!0,include_ids:i},l),type:t,dataType:"json",success:function(t){t.html&&($("#"+e+"_pagination_button_"+r.object_id).replaceWith(""),$("#pagination_content_"+r.object_id).replaceWith(t.html),TipTip.init())}})}else $.ajax({dataType:r.url.match(/.*(\.js\?|\?format=js)[^\?]*$/)||a?"json":"text",url:r.url,data:{page:r.page+o,per_page:r.per_page,skip_loading:!0,include_ids:i},type:t,success:function(t){if(""!=t){if(r.page+=o,$("#"+e+"_pagination_button_"+r.object_id).replaceWith(""),t=r.url.match(/.*(\.js\?|\?format=js)[^\?]*$/)||a?t.html:"<div>"+t+"</div>",a){$("#"+r.object_id).append("<div class='hidden' id='tmp_pagination_storage'></div>"),$("#tmp_pagination_storage").html(t);var n=$("#tmp_pagination_storage #"+r.object_id).detach();$("#pagination_content_"+r.object_id).replaceWith(n),$("#tmp_pagination_storage").remove()}else{var n=$(t).find("[id="+r.object_id+"]").html();"more"==e?$("#pagination_content_"+r.object_id).replaceWith(n):($("#"+r.object_id).replaceWith('<div id="'+r.object_id+'">'+n+"</div>"),$("#"+r.object_id).fadeTo(100,1))}r.bind_all(),$("body").click(),r.loading=!1,require(["qtip"],function(){$(".tiptip_bottom").qtip({show:{delay:0},defaultPosition:"bottom",maxWidth:"270px"}),$(".tiptip_top").qtip({show:{delay:0},defaultPosition:"top",maxWidth:"270px"}),$(".tiptip").qtip({show:{delay:0},defaultPosition:"top"}),$("#tiptip_holder").hover(function(){setTimeout(function(){$("#tiptip_holder").stop(),$("#tiptip_holder").show(),$("#tiptip_holder").css("opacity",1)},10)},function(){$("#tiptip_holder").hide()})}),selector_refresh()}}})})},AL={loadingImage:function(e){return"undefined"==typeof e&&(e=""),$('<img src="/images/shared/transparent-ajax-loader.gif" style="'+e+'" alt="Loading" class="loading_image" />')},centeredLoadingImage:function(){return AL.loadingImage("width: auto; margin: 0 auto; display: block; margin-top: 20px; padding-top: 20px; clear: both")}};Messages.initLightBox=function(e,t,n,i){function r(e,t){t.hide(),$(".message_sent").show(),$(document).trigger("messages.js_message_sent",[e]),setTimeout(function(){$(document).trigger("close.facybox")},2500)}function o(e,t){t.find(".ajax_loader").hide(),t.find("input[type='submit']").removeClass("loading"),t.find(".errors").html(e.errors).show()}var a=i&&i.force_multiple,s=i&&i.force_docs,l=i&&i.assign_class;if("undefined"!=typeof Messages.message_box_initialized&&!a)return!0;Messages.message_box_initialized=!0,$.facybox.settings.modal=!0,$(document).on("click",".close_facybox",function(){$(document).trigger("close.facybox")});var c;c=l?"."+l.replace(/\./,"")+"[data-recipient_id="+e+"][data-recipient_type="+t+"]":a?".message-lightbox[data-recipient_id="+e+"][data-recipient_type="+t+"]":".message-lightbox",$(document).on("click",c,function(){$.facybox.loading();var i={recipient_type:t,recipient_id:e};n&&(i.about_startup=n),s&&(i.force_docs=s),$.ajax({url:"/messages/new.js",data:i,dataType:"html",success:function(n){$.facybox.reveal($(n)),$(".new_message_lightbox textarea").focus();var s=$(".new_message_lightbox form").data("user_id"),l=$(".new_message_lightbox form").data("field_data_id"),c=$(".new_message_lightbox form").data("field_holder_id"),u=$(".new_message_lightbox form").data("is_admin");new MentionsAutocomplete(s,l,c,u),form=$(a?".new_message_lightbox form[data-recipient_id="+e+"][data-recipient_type="+t+"]":".new_message_lightbox form"),form.bind("submit",function(){$(this).find(".close_facybox").hide(),$(this).find(".g-button.blue").addClass("loading");var e=$(this);return $.ajax({url:"/messages.js",type:"post",data:$(this).serialize(),dataType:"json",success:function(t){$.extend(t,i),t.errors?o(t,e):r(t,e)}}),!1})},error:function(e){$.cookie("remember_user_token",null),window.location=e.responseText}})}),$(document).on("change",".new_message_lightbox select",function(){$("input[name='message[startup_id]']").val($(this).val());var e=Messages.startups[$(this).val()];$(".new_message_lightbox .startup_name").html(e.name),$(".new_message_lightbox .startup_possessive").html(e.possessive)})},function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};window.Autocomplete=function(){function t(t,n){var i,r,o;this.selector=t,this.closeAutocomplete=e(this.closeAutocomplete,this),this.openAutocomplete=e(this.openAutocomplete,this),this.selectAutocomplete=e(this.selectAutocomplete,this),this.focusAutocomplete=e(this.focusAutocomplete,this),this.tagsAutocomplete=e(this.tagsAutocomplete,this),this.searchAutocomplete=e(this.searchAutocomplete,this),this.taggingsAutocomplete=e(this.taggingsAutocomplete,this),this.enable=e(this.enable,this),this.disable=e(this.disable,this),$.extend(this,n),this.queryOptions=n.queryOptions||{},this.hide_counts=n.hide_counts,this.cache={},i={autoFocus:!0,html:!0,delay:null!=(r=this.delay)?r:"undefined"!=typeof SEARCH_MS_DELAY_AUTOCOMPLETE&&null!==SEARCH_MS_DELAY_AUTOCOMPLETE?SEARCH_MS_DELAY_AUTOCOMPLETE:50,source:n.tags?this.tagsAutocomplete:n.roles?this.taggingsAutocomplete:this.searchAutocomplete,open:this.openAutocomplete,close:this.closeAutocomplete,focus:this.focusAutocomplete,select:this.selectAutocomplete},i=$.extend(i,null!=(o=this.extra_ac_options)?o:{}),$(this.selector).autocomplete(i),$(this.selector).click(function(){var e,t;return t=$(this).val().trim(),e=$(this).autocomplete("option","minLength"),t.length>=e?$(this).autocomplete("search",t):void 0}),this.widget=$(this.selector).autocomplete("widget"),$(this.widget).addClass("search_autocomplete_ui al_shadow al_border_radius")}return t.prototype.disable=function(){return $(this.selector).autocomplete("disable")},t.prototype.enable=function(){return $(this.selector).autocomplete("enable")},t.prototype.taggingsAutocomplete=function(e,t){return e.term in this.cache&&t(this.cache[e.term]),this.lastXhr=$.ajax({url:"/autocomplete/taggings",data:$.extend({query:e.term},this.queryOptions),type:"get",dataType:"json",success:function(n){return function(i,r,o){var a,s;if(n.lastXhr===o&&$(n.selector).is(":focus")&&$(n.selector).val()===e.term)return s=function(){var e,t,n;for(n=[],e=0,t=i.length;t>e;e++)a=i[e],n.push(function(){return function(e){var t;return{value:e,label:'<div class="pic_cell">\n  <div class="pic_holder">\n    <img src="'+(null!=(t=e.pic)?t:"")+'" alt=""/>\n  </div>\n</div>\n<div class="right_cell u-textShadowWhite">\n  <div class="main">\n    '+e.highlight_name+'\n    <div class="item-type">'+e.info+"</div>\n  </div>\n</div>"}}}(this)(a));return n}.call(n),s.push({value:{name:e.term},label:"<div class='add_new'>Add new <strong>\""+e.term+'"</strong></div>'}),n.cache[e.term]=s,t(s)}}(this)})},t.prototype.searchAutocomplete=function(e,t){return e.term in this.cache&&t(this.cache[e.term]),this.lastXhr=$.ajax({url:this.custom_url||"/autocomplete/search",data:$.extend({query:e.term},this.queryOptions),type:"get",dataType:"json",success:function(n){return function(i,r,o){var a,s;return s=function(){var e,t,n;for(n=[],e=0,t=i.length;t>e;e++)a=i[e],n.push(function(e){var t,n;return t={value:{name:e.name,id:e.id,model:e.model},label:'<div class="pic_cell"><div class="pic_holder">\n<img src="'+(null!=(n=e.pic)?n:"")+'" alt=""/>\n</div></div>\n<div class="right_cell u-textShadowWhite">\n<div class="main">\n'+e.highlight_name+'\n<div class="item-type">'+e.type+"</div>\n</div></div>"}}(a));return n}(),n.cache[e.term]=s,n.lastXhr===o&&$(n.selector).is(":focus")&&$(n.selector).val()===e.term?t(s):void 0}}(this)})},t.prototype.tagsAutocomplete=function(e,t){var n;return n=function(e,t){return"undefined"!=typeof e&&null!==e&&""!==e?e:t},e.term in this.cache&&t(this.cache[e.term]),this.lastXhr=$.ajax({url:this.custom_url||"/autocomplete/new_tags",data:$.extend({query:e.term},this.queryOptions),type:"get",dataType:"json",success:function(i){return function(r,o,a){var s,l;return l=function(){var t,i,o;for(o=[],t=0,i=r.length;i>t;t++)s=r[t],o.push(function(t){return function(i){var r,o;return i.tag.highlight_name=i.tag.display_name.toTitleCase().replaceAutocomplete(e.term,"<span class=matched_substring>%s</span>"),i.tag.followers=t.hide_counts||null==i.counts.User?"":i.counts.User+" follower"+(1===i.counts.User?"":"s"),r={value:{name:i.tag.name,id:i.tag.follower_id,model:i.tag.model,item:i.tag},label:'<div class="pic_cell"><div class="pic_holder">\n<img src="'+(null!=(o=i.tag.pic)?o:"")+'" alt=""/>\n</div></div>\n<div class="right_cell u-textShadowWhite">\n<div class="main">\n'+i.tag.highlight_name+'\n<div class="item-type">'+n(i.tag.description,n(i.tag.followers,n(i.tag.type,"")))+"</div>\n</div></div>"}}}(this)(s));return o}.call(i),i.addText&&l.push({value:null,label:'<div class="pic_cell"><div class="pic_holder">\n</div></div>\n<div class="right_cell u-textShadowWhite">\n<div class="main">\n'+i.addText+'\n&ldquo;<span class="matched_substring">'+e.term+'</span>&rdquo;\n<div class="item-type"></div>\n</div></div>'}),i.cache[e.term]=l,i.lastXhr===a&&$(i.selector).is(":focus")&&$(i.selector).val()===e.term?t(l):void 0}}(this)})},t.prototype.focusAutocomplete=function(){return!1},t.prototype.selectAutocomplete=function(e,t){return this.selectCallback?this.additionalCallbackOptions?this.selectCallback(t.item.value,this.additionalCallbackOptions):this.selectCallback(t.item.value):$(this.selector).val(t.item.value.name),!1},t.prototype.openAutocomplete=function(){return this.opened=!0},t.prototype.closeAutocomplete=function(){return this.opened=!1},t}(),define("lib/autocomplete",[],function(){return window.Autocomplete})}.call(this),function(){}.call(this);