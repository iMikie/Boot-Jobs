(function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=function(e,t){return function(){return e.apply(t,arguments)}};define(["jquery","backbone","models/new_tagging","models/startup_role","models/repository","lib/form","lib/transitional_autocomplete","underscore","lib/associations"],function(t,i,r,o,a,s,l,u,c){var d,h,p,f,g,m,v,y,b;return b=function(e,n){var i;return i={interpolate:/\{\{(.+?)\}\}/g,evaluate:/\{\-(.+?)\-\}/g},u.template(t(e).html(),n,i)},v=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.removeSubView=function(e){return this.stopListening(e),e.remove()},n}(i.View),d=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click .js-add":"add","click .js-cancel":"cancel"},n.prototype.add=function(){return this.$(".js-add").addClass("c-button--loading"),this.$(".js-cancel").addClass("c-button--disabled"),this.trigger("add")},n.prototype.cancel=function(){return this.reset(),this.trigger("cancel")},n.prototype.reset=function(){return this.$(".js-add").removeClass("c-button--loading"),this.$(".js-cancel").removeClass("c-button--disabled")},n}(i.View),h=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(){return this.controlGroup=new d({el:this.$(".js-add-cancel-group")}),this.listenTo(this.controlGroup,"cancel",function(e){return function(){return e.trigger("cancel")}}(this)),this.listenTo(this.controlGroup,"add",function(e){return function(){var t;return t=e.create(),t.isValid()?void 0:e.showErrors(t.validationError)}}(this))},n.prototype.create=function(){return this.collection.create(this.attributes())},n.prototype.showErrors=function(e){return this.show({clear:!1}),this.$(".js-errors").show().html(e.join("<br>"))},n.prototype.show=function(e){var t,n;return n=u.extend({focus:!0,clear:!0},e||{}),this.controlGroup.reset(),this.$el.show(),t=this.$("input[type='text'],select,textarea"),n.clear&&t.val(""),n.focus&&t.first().focus(),this.$(".js-errors").hide()},n.prototype.attributes=function(){var e,t,n,i,r;for(e={},r=this.fields,n=0,i=r.length;i>n;n++)t=r[n],e[t]=this.$("[name='"+t+"']").val();return e},n}(i.View),g=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click .js-add-new-tagging":"showNewTaggingView"},n.prototype.initialize=function(){return this.collection=new this.collectionClass,this.listenTo(this.collection,"reset",function(e){return function(){return e.collectionReset()}}(this)),this.listenTo(this.collection,"remove",function(e){return function(t){return e.collectionRemove(t)}}(this)),this.collection.reset(this.$el.data("taggings")),this.addNewTaggingView=new this.newTaggingViewClass({el:this.$(".js-new-form"),collection:this.collection}),this.listenTo(this.addNewTaggingView,"cancel",function(e){return function(){return e.hideTaggingView()}}(this))},n.prototype.collectionRemove=function(e){var t;return(t=u.find(this.rowViews,function(t){return t.model.id===e.id}))?(this.removeSubView(t),this.rowViews.splice(u.indexOf(this.rowViews,t),1)):void 0},n.prototype.collectionReset=function(){var e,t,n,i,r,o,a,s,l,c;if(!u.isEmpty(this.rowViews))for(a=this.rowViews,t=0,i=a.length;i>t;t++)c=a[t],c.remove();for(this.rowViews=[],e=this.$(".js-list-container"),s=this.collection.models,l=[],n=0,r=s.length;r>n;n++)o=s[n],c=new this.rowViewClass({model:o}),this.rowViews.push(c),l.push(e.append(c.el));return l},n.prototype.showNewTaggingView=function(e){return this.$(".js-add-new-tagging").hide(),this.addNewTaggingView.show(e)},n.prototype.hideTaggingView=function(){return this.$(".js-add-new-tagging").show(),this.addNewTaggingView.$el.hide()},n}(v),p=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.collectionReset=function(){var e,t,i,r;for(n.__super__.collectionReset.apply(this,arguments),i=this.rowViews,e=0,t=i.length;t>e;e++)r=i[e],this.listenTo(r,"edit",function(e){return function(t){return e.editTagging(t)}}(this));return this.addNewTaggingView?this.isEditing?this.hideTaggingView():this.showNewTaggingView():void 0},n.prototype.editTagging=function(e){return this.isEditing=!0,this.$(".js-add-new-tagging").hide(),this.addNewTaggingView.edit(e)},n.prototype.hideTaggingView=function(){return this.isEditing=!1,n.__super__.hideTaggingView.apply(this,arguments)},n}(g),f=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.create=function(e){var n;return n=new this.model(e),n.isValid()&&t.ajax({url:this.createURL,type:"post",data:e,success:function(e){return function(t){return e.reset(t.taggings)}}(this)}),n},i}(i.Collection),m=function(i){function r(){return this.render=n(this.render,this),this.delete_tag=n(this.delete_tag,this),this.initialize=n(this.initialize,this),r.__super__.constructor.apply(this,arguments)}return e(r,i),r.prototype.initialize=function(){return this.$(".delete > a",this).removeAttr("onClick")},r.prototype.events={"click img.delete":"delete_tag"},r.prototype.delete_tag=function(e){return this.$el.css("opacity","0.7"),e.preventDefault(),this.model.isNew()?(this.model.destroy(),this.$el.fadeOut(function(e){return function(){return e.remove()}}(this))):this.model.destroy({wait:!0,success:function(e){return function(){return e.$el.fadeOut(function(){return e.remove()})}}(this)})},r.prototype.render=function(){var e;return e='<div data-tag_id="'+this.model.get("new_tag").id+'" class="new_taggings tag_edit">\n  <a href="'+this.model.get("new_tag").slug_url+'" target="_blank">'+this.model.get("new_tag").display_name+'</a>\n  <img class="delete" src="/images/tag-field/close-tag.png" title="Remove"/>\n  </div>',this.$el=t(e).data("new_tagging",this.model.toJSON()),this.el=this.$el.get()[0],this.delegateEvents(),this},r}(i.View),y={},y.tag_edit=function(e,t){var n;return n=a.get(r).bootstrap(t.data("new_tagging")),new m({el:this,model:n})},y.tag_form_field=function(e){var n,i,o,l,u,c,d,h,p,f,g,v,y,b,_,w,x,C;for(i=e(".input.edit input[type=text].autocomplete"),p=i.attr("name").match(/([^\[]+)\[.*/)[1],"new_tagging"===p?(n=e('input[name="new_tagging[new_tag][display_name]"]'),o=e('input[name="new_tagging[new_tag][slug_url]"]'),l=e('input[name="new_tagging[new_tag][id]"]')):(n=e('input[name="'+p+'[new_tagging][new_tag][display_name]"]'),o=e('input[name="'+p+'[new_tagging][new_tag][slug_url]"]'),l=e('input[name="'+p+'[new_tagging][new_tag][id]"]')),C=!1,y=function(){return function(){return C=!0,e("input.add").hide().after(AL.loadingImage())}}(this),b=function(){return function(){return e("input.add").val("Add").siblings("img").remove(),e("input.add:not(.hidden)").show(),i.val(""),n.val(""),o.val(""),l.val(""),C=!1}}(this),u=function(){return function(e){var t,n,i,o,l;return n=new r(s.attributes(e,"new_tagging"===p?"new_tagging":p+"[new_tagging]")),""===n.get("new_tag").display_name.trim()?b():(l=function(){return a.get(r).push(n),b()},(null!=(i=n.get("new_taggable_type"))?i.length:void 0)>0&&(null!=(o=n.get("new_taggable_id"))?o.toString().length:void 0)>0?n.save({},{success:l,error:b}):(t=a.get(r).find(function(e){var t,i;return(null!=(t=e.get("new_taggable_type"))?t.length:void 0)>0&&(null!=(i=e.get("new_taggable_id"))?i.length:void 0)>0?!1:e.get("new_taggable_field")!==n.get("new_taggable_field")?!1:e.get("new_tag").id===n.get("new_tag").id}),t?b():l()),!1)}}(this),e("input.add").click(function(){return function(t){return t.preventDefault(),u(e(".tag_form_field_form"))}}(this)),i.keydown(function(e){return 13!==e.which}),g={tag_type:t(this).data("tag_type")},v=["new_taggable_id","new_taggable_type","new_taggable_field"],h=0,f=v.length;f>h;h++)c=v[h],g[c]="new_tagging"===p?t("input[name='new_tagging["+c+"]']",this).val():t("input[name='"+p+"[new_tagging]["+c+"]']",this).val();return new Autocomplete(t("input.autocomplete",this),{user_id:t(this).data("user_id"),selectCallback:function(){return function(t){return C?void 0:(y(),n.val(t.item.display_name),i.val(t.item.name),o.val(t.item.slug_url),l.val(t.item.id),u(e(".tag_form_field_form")))}}(this),queryOptions:g,tags:!0}),_=g.tag_type,c=g.new_taggable_field,x=g.new_taggable_type,w=g.new_taggable_id,d=function(){return a.get(r).reduce(function(e,t){var n;return n=t.get("new_tag"),n.tag_type===_&&t.get("new_taggable_field")===c&&t.get("new_taggable_type")===x&&t.get("new_taggable_id").toString()===w.toString()?e+1:e},0)},a.get(r).on("remove",function(n){return function(i){var r;return r=i.get("new_tag"),r.tag_type===_&&i.get("new_taggable_field")===c&&i.get("new_taggable_type")===x&&i.get("new_taggable_id").toString()===w.toString()?(e(".current").each(function(){return t(".tag_edit[data-tag_id='"+r.id+"']",this).remove()}),null!=t(n).data("max")&&t(n).data("max")>d()&&e(".tag_form_field_form").show().find("input").focus(),e(".tag_form_field_form .new_taggings_post").each(function(){var e,n;return n=t(this),e=n.find("input[name$='new_tag_id]'][value='"+r.id+"']"),e.nextUntil("input[name$='new_tag_id]']").remove(),e.remove()})):void 0}}(this)),a.get(r).on("add",function(n){return function(i){var r;return r=i.get("new_tag"),r.tag_type===_&&i.get("new_taggable_field")===c&&i.get("new_taggable_type")===x&&i.get("new_taggable_id").toString()===w.toString()?(e(".current").each(function(){var e;return 0===t(".tag_edit[data-tag_id='"+r.id+"']",this).length?(e=new m({model:i}),e.render(),t(this).append(e.$el)):void 0}),t(n).data("max")===d()&&e(".tag_form_field_form").hide(),e(".tag_form_field_form .new_taggings_post").each(function(){var e,n,r;return r=t(this),e=r.find("input[type=hidden][value=]:disabled"),e.prop("disabled",!1),n=e.clone(),n.prop("disabled",!0),e.filter("input[name$='new_tag_id]']").val(i.get("new_tag").id),e.filter("input[name$='new_tag_follower_id]']").val(i.get("new_tag").follower_id),e.filter("input[name$='new_taggable_field]']").val(i.get("new_taggable_field")),r.append(n)})):void 0}}(this)),t(this).data("max")<=d()&&e(".tag_form_field_form").hide(),t(this).on("reset",function(){var e;return e=t(this).find(".new_taggings_post"),e.find("input[type=hidden]").slice(0,-3).remove(),e.find("input[type=hidden]").val(""),i.val(""),n.val(""),o.val(""),l.val(""),a.get(r).each(function(e){var t;return t=e.get("new_tag"),t.tag_type===_&&e.get("new_taggable_field")===c&&e.get("new_taggable_type")===x&&e.get("new_taggable_id").toString()===w.toString()?a.get(r).remove(e):void 0})}),t(this).on("value",function(e,t){var n,i,o,s,l;for(s=[],n=0,i=t.length;i>n;n++)l=t[n],o=new r(l),s.push(a.get(r).push(o));return s})},y.college_tagger=function(t,n){var r,o,a,s,c;return a=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.urlRoot="/new_taggings",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.id=u.compact([this.get("id"),this.get("meta_data_id")]).join(":")},n.prototype.sync=function(e,t,i){var r;return"delete"===e&&(r=t.get("meta_data_id"))&&(i||(i={}),i.url="/new_taggings/remove_college_meta_data/"+r,i.contentType="application/json"),n.__super__.sync.call(this,e,t,i)},n.prototype.validate=function(){var e;return e=[],u.isEmpty(this.get("name"))&&e.push("Please enter a college name"),u.isEmpty(this.get("major"))&&e.push("Please enter a major"),e.length>0?e:void 0},n}(i.Model),s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=a,n.prototype.createURL="/new_taggings/add_college",n}(f),o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="college-row-view",n.prototype.events=function(){return{"click .js-edit":function(e){return function(){return e.trigger("edit",e.model)}}(this),"click .js-delete":function(e){return function(){return e.model.destroy()}}(this)}},n.prototype.initialize=function(){return this.render()},n.prototype.metaData=function(){var e,t,n,i,r;return n=[this.model.get("major"),this.model.get("degree"),this.model.get("year")],t=n[0],e=n[1],r=n[2],i="",(e||t)&&(i="&middot; "),i+=u.compact([e,t]).join(", "),r&&(i+=" "+r),i},n.prototype.render=function(){var e;return e=u.extend(this.model.toJSON(),{meta_data:this.metaData()}),this.$el.html(b("#college-row-template",e))},n}(v),r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.fields=["name","major","degree","year"],n.prototype.initialize=function(){var e;return n.__super__.initialize.apply(this,arguments),e=new l.TagAutocomplete({el:this.$("input[name='name']"),tag_type:"CollegeTag"}),this.listenTo(e,"select",function(e){return function(t){return e.$("input[name='name']").attr("value",t.tag.display_name),e.$("input[name='major']").focus()}}(this))},n.prototype.edit=function(e){var t,n,i,r;for(r=this.fields,n=0,i=r.length;i>n;n++)t=r[n],this.$("input[name='"+t+"']").val(e.get(t));return this.show({clear:!1})},n}(h),new(c=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.collectionClass=s,n.prototype.rowViewClass=o,n.prototype.newTaggingViewClass=r,n}(p))({el:n})},y.startup_role_tagger=function(t,n){var r,a,c,d,g,m,y;return y=u.extend({},i.Events),m=n.data("tagged-id"),g=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.id=u.compact([this.get("id"),this.get("metadata_id")]).join(":")},n.prototype.sync=function(e,t,i){var r,o;return i||(i={}),i.contentType="application/json","delete"===e&&(r=t.get("metadata_id"))?(i.data=JSON.stringify({source:"talent_profile"}),i.url="/startup_role_metadatas/"+r):(o=t.get("token"))&&(i.url="/startup_roles/"+o),n.__super__.sync.call(this,e,t,i)},n.prototype.validate=function(){var e;return e=[],u.isEmpty(this.get("company_name"))&&e.push("Please enter a company name"),u.isEmpty(this.get("title"))&&e.push("Please enter a title"),u.isEmpty(this.get("started_at_year"))&&e.push("Please enter a start year"),u.isEmpty(this.get("ended_at_year"))&&!this.get("current")&&e.push("Please enter an end year"),e.length>0?e:void 0},n}(o),a=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=g,n.prototype.create=function(e,t){var n;return n=new this.model(e),n.save({source:"talent_profile",tagged_type:"User",tagged_id:m},{success:function(e){return function(t,n){return e.reset(n.roles),y.trigger("totalExperienceChanged",n.combined_experience)}}(this),error:function(){return function(e,n){return t(n.responseJSON)}}(this)}),n},n}(f),d=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="startup-role-view",n.prototype.events=function(){return{"click .js-edit":function(e){return function(){return e.trigger("edit",e.model)}}(this),"click .js-delete":"destroyModel"}},n.prototype.initialize=function(){return this.render()},n.prototype.render=function(){return this.$el.html(b("#startup-role-template",this.model.toJSON()))},n.prototype.destroyModel=function(){return this.model.destroy({success:function(e,t){return y.trigger("totalExperienceChanged",t.combined_experience)}})},n}(v),r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.fields=["company_name","title","started_at_month","started_at_year","ended_at_month","ended_at_year","description","metadata_id"],n.prototype.events={"click .js-current-job":"updateCurrentlyAt"},n.prototype.initialize=function(){var e,t,i;return n.__super__.initialize.apply(this,arguments),i=new l.TagAutocomplete({el:this.$('input[name="company_name"]'),tag_type:"CompanyTag"}),this.listenTo(i,"select",function(e){return function(t){return e.$("input[name='company_name']").val(t.tag.display_name),e.$("input[name='title']").focus()}}(this)),e=this.$("textarea"),t=e.next(".character_counter"),this.characterCounter=new s.CharacterCounter({el:e,max:t.data("max"),container:t})},n.prototype.create=function(){return this.collection.create(this.attributes(),function(e){return function(t){return e.showErrors(u.values(t.errors))}}(this))},n.prototype.show=function(){return n.__super__.show.apply(this,arguments),this.characterCounter.render(),this.updateCurrentlyAt()},n.prototype.edit=function(e){var t,n,i,r;for(r=this.fields,n=0,i=r.length;i>n;n++)t=r[n],this.$("[name='"+t+"']").val(e.get(t));return this.$(".js-current-job").prop("checked",e.get("current")),this.model=e,this.show({clear:!1})},n.prototype.attributes=function(){var e,t,i;return e=n.__super__.attributes.apply(this,arguments),this.model&&e.company_name!==this.model.get("company_name")&&delete this.model,e.current=this.$(".js-current-job").prop("checked"),e.token=null!=(t=this.model)?t.get("token"):void 0,e.role=(null!=(i=this.model)?i.get("role"):void 0)||"employee",e},n.prototype.updateCurrentlyAt=function(){var e;return e=this.$(".js-current-job").prop("checked"),this.$(".js-ended-at-input").toggle(!e),this.$(".js-ended-at-present").toggle(e),e?this.$(".js-ended-at-input").find("input, select").val(""):void 0},n}(h),c=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.collectionClass=a,n.prototype.rowViewClass=d,n.prototype.newTaggingViewClass=r,n}(p),new c({el:n}),y},y.skill_tagger=function(n,r){var o,a,s,u,c;return a=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.urlRoot="/new_taggings",n.prototype.sync=function(e,t,i){return"update"===e&&(i||(i={}),i.contentType="application/json",i.data=JSON.stringify({new_tagging:{level:t.get("level")}})),n.__super__.sync.call(this,e,t,i)},n.prototype.validate=function(){var e,t;return e=[],t=this.get("name"),t&&0!==t.trim().length?t.length>45&&e.push("Skill must be less than 45 characters"):e.push("Please enter a skill"),-1!==t.indexOf(",")&&e.push("Skill cannot include commas"),e.length>0?e:void 0},n}(i.Model),s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=a,n.prototype.createURL="/new_taggings/add_skill",n}(f),c=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.className="skill-row-view s-grid0 s-grid--outer",i.prototype.events=function(){return{"click .js-delete":function(e){return function(){return e.model.destroy()}}(this),"change .js-level":function(e){return function(n){return e.model.save({level:t(n.target).val()})}}(this)}},i.prototype.initialize=function(){return this.render()},i.prototype.render=function(){return this.$el.html(b("#skill-row-template",this.model.toJSON())),this.model.get("level")?this.$(".js-level-"+this.model.get("level")).prop("checked",!0):void 0},i}(v),o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.fields=["name"],n.prototype.events=function(){return{'keyup input[name="name"]':function(e){return function(t){return 13===t.which?e.controlGroup.add():void 0}}(this)}},n.prototype.initialize=function(){var e;return n.__super__.initialize.apply(this,arguments),e=new l.TagAutocomplete({el:this.$('input[name="name"]'),tag_type:"SkillTag"}),this.listenTo(e,"select",function(e){return function(t){return e.$('input[name="name"]').val(t.tag.display_name)}}(this))},n}(h),new(u=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.collectionClass=s,n.prototype.rowViewClass=c,n.prototype.newTaggingViewClass=o,n.prototype.collectionReset=function(){return n.__super__.collectionReset.apply(this,arguments),this.addNewTaggingView?this.addNewTaggingView.show():void 0},n}(g))({el:r})},y.tag_form_simple=function(e,t){var n,o,a,s,l,u,d;return s=t.data("tag_type"),a=t.data("field"),u=t.data("taggable_type"),l=t.data("taggable_id"),d=t.data("taggings")||[],o=function(){var e,t,i;for(i=[],e=0,t=d.length;t>e;e++)n=d[e],i.push(new r(n));return i}(),new c.NewTaggingField({el:t,tag_type:s,new_taggable_field:a,new_taggable_type:u,new_taggable_id:l,container:e(".association_container"),collection:new i.Collection(o)})},y})}).call(this);